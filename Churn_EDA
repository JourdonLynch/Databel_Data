Average account length of all accounts:

SELECT
  ROUND(AVG(`Account Length _in months_`),2)
FROM
  Databel.Data


Average account length of churned accounts:

SELECT
  ROUND(AVG(`Account Length _in months_`),2) AS avg_account_length
FROM
  Databel.Data
WHERE
  `Churn Label` = TRUE


Churn rate of all customers:

SELECT
 CONCAT(
   ROUND(
     (
       SELECT
         COUNT(`Customer ID`)
       FROM
         Databel.Data
       WHERE
         `Churn Label` = TRUE
     ) * (100)
       / (
         SELECT
           COUNT(`Customer ID`)
         FROM
           Databel.Data
       ),
     2),
   "%") AS churn_rate


Churn rate of internationally active customers, by international plan status:

SELECT
  `Intl Plan`,
  CONCAT(
    ROUND(
      SUM(CASE WHEN `Churn Label` = TRUE THEN 1 ELSE 0 END) * 100.0
      / COUNT(*),
      2
    ),
    '%'
  ) AS churn_rate
FROM Databel.Data
WHERE `Intl Active` = TRUE
GROUP BY `Intl Plan`
ORDER BY `Intl Plan`;
---

Churn rate of customers with 0-5 GB download with an unlimited data plan:
SELECT
  CONCAT(
    ROUND(
      (
        SELECT
          COUNT(`Customer ID`)
        FROM
          Databel.Data
        WHERE
          `Avg Monthly GB Download` < 5
          AND `Unlimited Data Plan` = FALSE
          AND `Churn Label` = TRUE
      ) * (100)
        / (
          SELECT
            COUNT(`Customer ID`)
          FROM
            Databel.Data
          WHERE
            `Avg Monthly GB Download` < 5
            AND `Unlimited Data Plan` = TRUE
        ),
      2),
    '%')


Churn rate of customers with 0-5 GB download without an unlimited data plan:
SELECT
  CONCAT(
    ROUND(
      (
        SELECT
          COUNT(`Customer ID`)
        FROM
          Databel.Data
        WHERE
          `Avg Monthly GB Download` < 5
          AND `Unlimited Data Plan` = FALSE
          AND `Churn Label` = TRUE
      ) * (100)
        / (
          SELECT
            COUNT(`Customer ID`)
          FROM
            Databel.Data
          WHERE
            `Avg Monthly GB Download` < 5
            AND `Unlimited Data Plan` = FALSE
        ),
      2),
    '%')

         

Churn rate of customers with 5-10 GB download with an unlimited data plan:

SELECT
  CONCAT(
    ROUND(
      (
        SELECT
          COUNT(`Customer ID`)
        FROM
          Databel.Data
        WHERE
          `Avg Monthly GB Download` >= 5
          AND `Avg Monthly GB Download` < 10
          AND `Unlimited Data Plan` = TRUE
          AND `Churn Label` = TRUE
      ) * (100)
        / (
          SELECT
            COUNT(`Customer ID`)
          FROM
            Databel.Data
          WHERE
            `Avg Monthly GB Download` >= 5
            AND `Avg Monthly GB Download` < 10
            AND `Unlimited Data Plan` = TRUE
        ),
      2),
    '%')


Churn rate of customers with 5-10 GB download without an unlimited data plan:

SELECT
  CONCAT(
    ROUND(
      (
        SELECT
          COUNT(`Customer ID`)
        FROM
          Databel.Data
        WHERE
          `Avg Monthly GB Download` >= 5
          AND `Avg Monthly GB Download` < 10
          AND `Unlimited Data Plan` = FALSE
          AND `Churn Label` = TRUE
      ) * (100)
        / (
          SELECT
            COUNT(`Customer ID`)
          FROM
            Databel.Data
          WHERE
            `Avg Monthly GB Download` >= 5
            AND `Avg Monthly GB Download` < 10
            AND `Unlimited Data Plan` = FALSE
        ),
      2),
    '%') AS churn_rate


Churn Rate by payment type:

SELECT
  `Payment Method`,
  CONCAT(
    ROUND(
      SUM(CASE WHEN `Churn label` = TRUE THEN 1 ELSE 0 END)
        * (100)
        / COUNT(*),
      2),
    '%')
    AS churn_rate
FROM Databel.Data
GROUP BY `Payment Method`
ORDER BY
  ROUND(
    SUM(CASE WHEN `Churn label` = TRUE THEN 1 ELSE 0 END) * 100.0
    / COUNT(*),
    2
  ) DESC

Churn Rate by contract type:

SELECT
  `Contract Type`,
  CONCAT(
    ROUND(
      SUM(CASE WHEN `Churn label` = TRUE THEN 1 ELSE 0 END)
        * (100)
        / COUNT(*),
      2),
    '%')
    AS churn_rate
FROM Databel.Data
GROUP BY `Contract Type`
ORDER BY
  ROUND(
    SUM(CASE WHEN `Churn label` = TRUE THEN 1 ELSE 0 END) * 100.0
    / COUNT(*),
    2
  ) DESC


Churn Rate of customers based on group status:

 SELECT
  `Group`,
  ROUND(
    SUM(CASE WHEN `Churn Label` = TRUE THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2)
    AS churn_rate
FROM Databel.Data
GROUP BY `Group`
ORDER BY `Group`;


--Churn rate by Churn Category

WITH
  Churn_Reasons AS(
  SELECT
    COUNT(`Customer ID`) AS Number,
    `Churn Category`
  FROM
    `Databel.Data`
  WHERE
    `Churn Category` IS NOT NULL
  GROUP BY
    `Churn Category` )
SELECT
  CASE
    WHEN RANK()OVER(ORDER BY Churn_Reasons.Number DESC ) = 1 THEN "Competitor"
    WHEN RANK()OVER(ORDER BY Churn_Reasons.Number DESC ) = 2 THEN "Attitude"
    WHEN RANK()OVER(ORDER BY Churn_Reasons.Number DESC ) = 3 THEN "Dissatisfaction"
    WHEN RANK()OVER(ORDER BY Churn_Reasons.Number DESC ) = 4 THEN "Price"
    WHEN RANK()OVER(ORDER BY Churn_Reasons.Number DESC ) = 5 THEN "Other"
END
  ,
  ROUND(Churn_Reasons.Number*(100)/COUNT(`Customer ID`),2) AS `Churn Rate`
FROM
  Churn_Reasons,
  Databel.Data AS D
WHERE
  `Churn Label` = TRUE
GROUP BY
  Churn_Reasons.Number
ORDER BY
  Churn_Reasons.Number DESC
